<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Dashboard</title>
<style>
body{font-family:'Poppins',sans-serif;margin:0;padding:0;background:#2575fc;color:white;}
.container{padding:20px;}
h2{text-align:center;margin-bottom:20px;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;}
.card{background:rgba(0,0,0,0.6);padding:10px;border-radius:10px;text-align:center;cursor:pointer;}
.card img{width:100%;height:120px;object-fit:cover;border-radius:10px;}
.status{margin-top:5px;font-size:14px;}
button{padding:8px 12px;margin-top:5px;border:none;border-radius:6px;background:#ff4b2b;color:white;cursor:pointer;}
</style>
</head>
<body>

<div class="container">
<h2>Available Models</h2>
<div class="grid" id="modelsGrid"></div>
<button onclick="logout()">Logout</button>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
// ðŸ”¹ Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCf6oj1SwC9FIetbI_TAxKNmpx0qm4zrvQ",
  authDomain: "puja-fun-service.firebaseapp.com",
  databaseURL: "https://puja-fun-service-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "puja-fun-service",
  storageBucket: "puja-fun-service.appspot.com",
  messagingSenderId: "559424092727",
  appId: "1:559424092727:web:35f7180b49b0a748c95db2"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ðŸ”¹ Get logged user
let loggedUser = JSON.parse(localStorage.getItem("loggedUser"));
if(!loggedUser){
  alert("Please login first!");
  window.location.href = "login.html";
}

// ðŸ”¹ Load Models
function loadModels(){
  db.ref("users").orderByChild("role").equalTo("model").on("value", snapshot => {
    const grid = document.getElementById("modelsGrid");
    grid.innerHTML = "";
    snapshot.forEach(snap => {
      const model = snap.val();
      if(model.status === "active"){
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <img src="${model.photos && model.photos[0]? model.photos[0]:'https://via.placeholder.com/150'}">
          <h4>${model.fullname}</h4>
          <div class="status">${model.online?'Online':'Offline'}</div>`;
        div.onclick = ()=> openProfile(snap.key);
        grid.appendChild(div);
      }
    });
  });
}

// ðŸ”¹ Open Model Profile
function openProfile(uid){
  window.location.href = "model_profile.html?uid=" + uid;
}

// ðŸ”¹ Logout
function logout(){
  localStorage.removeItem("loggedUser");
  window.location.href = "login.html";
}
<!-- ðŸ”¹ Firebase + Call Integration Script for User Dashboard -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
// ðŸ”¹ Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCf6oj1SwC9FIetbI_TAxKNmpx0qm4zrvQ",
  authDomain: "puja-fun-service.firebaseapp.com",
  databaseURL: "https://puja-fun-service-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "puja-fun-service",
  storageBucket: "puja-fun-service.appspot.com",
  messagingSenderId: "559424092727",
  appId: "1:559424092727:web:35f7180b49b0a748c95db2"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ðŸ”¹ Logged-in user
let loggedUser = JSON.parse(localStorage.getItem("loggedUser"));
if(!loggedUser){ 
  alert("Login first"); 
  window.location.href = "login.html"; 
}

// -------------------- Call Initiate --------------------
function initiateCall(type, modelUid){
  // ðŸ”¹ Payment logic (Razorpay / QR / UPI)
  // After payment success:
  onPaymentSuccess(type, modelUid);
}

function onPaymentSuccess(callType, modelUid){
  const callRef = db.ref("calls").push();
  const callId = callRef.key;

  callRef.set({
    from: loggedUser.uid,
    to: modelUid,
    type: callType,   // "video" or "audio"
    status: "pending",
    timestamp: Date.now()
  }).then(()=>{
    // Redirect to call.html
    window.location.href = "call.html?callId=" + callId;
  });
}
</script>
// ðŸ”¹ Initial load
loadModels();
</script>

</body>
</html>